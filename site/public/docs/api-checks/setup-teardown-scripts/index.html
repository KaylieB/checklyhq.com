<!DOCTYPE html>
<html lang="en">
<head>
  <head>
  <title>Setup &amp; teardown scripts | Checkly </title>
  <meta charset="utf-8" />
  <meta name="description" content="You can tailor each HTTP request made by an API check to your exact situation by using setup and/or teardown scripts.
 Setup scripts give you access to properties like the URL, headers and query parameters of the HTTP request as well as all environment variables. Popular use cases are signing HMAC request. requesting tokens and setting up test data. Teardown scripts give you access to all the same data as the setup scripts plus the response object, allowing you to read and modify the response." />
  <meta name="viewport" content="width=device-width" initial-scale="1" maximum-scale="1" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Setup &amp; teardown scripts | Checkly " />
  <meta property="og:description" content="You can tailor each HTTP request made by an API check to your exact situation by using setup and/or teardown scripts.
 Setup scripts give you access to properties like the URL, headers and query parameters of the HTTP request as well as all environment variables. Popular use cases are signing HMAC request. requesting tokens and setting up test data. Teardown scripts give you access to all the same data as the setup scripts plus the response object, allowing you to read and modify the response." />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://checklyhq.com/images/dashboard-screen@2x.png" />
  <meta property="twitter:card" content="summary" />
  <meta property="twitter:title" content="Setup &amp; teardown scripts | Checkly " />
  <meta property="twitter:description" content="You can tailor each HTTP request made by an API check to your exact situation by using setup and/or teardown scripts.
 Setup scripts give you access to properties like the URL, headers and query parameters of the HTTP request as well as all environment variables. Popular use cases are signing HMAC request. requesting tokens and setting up test data. Teardown scripts give you access to all the same data as the setup scripts plus the response object, allowing you to read and modify the response." />
  <meta property="og:image" content="https://checklyhq.com/images/dashboard-screen@2x.png" />
  <meta name="msvalidate.01" content="36F243A91FAA24DE468D8A8EECF33554" />
  <link rel="icon" type="image/png" href="/images/racoon_favicon.png" />
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>
  <link rel="alternate" href="https://checklyhq.com/docs/api-checks/setup-teardown-scripts/" hreflang="en-us" />
  <link rel="canonical" href="https://checklyhq.com/docs/api-checks/setup-teardown-scripts/" />
  <link rel="stylesheet" href="/css/style.css" />
  <script async src="https://cdn.cookielaw.org/consent/e4c8a868-c0ad-4c0c-b61e-f6eb6cad2810.js" type="text/javascript" charset="UTF-8"></script>
  <script type="text/javascript">
    function OptanonWrapper() {}
  </script>
  <style>
    .qc-cmp-ui {
      background-color: #45c8f1 !important;
    }

    .qc-cmp-publisher-purposes-table .qc-cmp-table-header {
      background-color: #fafafa !important;
    }

    .qc-cmp-publisher-purposes-table .qc-cmp-table-row {
      background-color: #ffffff !important;
    }
  </style>
  
  <script type="text/plain" async src="https://www.googletagmanager.com/gtag/js?id=UA-110523681-1" class="optanon-category-2"></script>
  <script type="text/plain" async class="optanon-category-2">
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-110523681-1');
  </script>
  
  <script>
    window.intercomSettings = {
      app_id: 'ep3ft8gg',
      custom_launcher_selector: '.open-intercom-link'
    }
  </script>
  <script async class="optanon-category-2">(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/ep3ft8gg';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();</script>

  <script type="text/javascript" class="optanon-category-2">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","resetIdentity","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("3553865455");
  </script>

  
  <script type="text/javascript" class="optanon-category-2">
    (function(h,o,t,j,a,r){
      h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
      h._hjSettings={hjid:717179,hjsv:6};
      a=o.getElementsByTagName('head')[0];
      r=o.createElement('script');r.async=1;
      r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
      a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
</head>

</head>

<body>
  <nav class="navbar navbar-toggleable-md fixed-top">
  <div class="container">
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"><span></span><span></span><span></span></button>
    <a class="navbar-brand mr-2" href="/"><img src="/images/text_racoon_logo.svg" width="120" alt="checkly logo"/></a><a
      class="callout" href="/jobs">We're hiring!</a>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" data-toggle="dropdown"
                                         id="navbarDropdownMenuLink" href="#">Product</a>
          <div class="dropdown-menu big-drop-shadow product-dropdown"><a class="dropdown-item"
                                                                         href="/product/api-monitoring/">API
            Monitoring</a><a class="dropdown-item" href="/product/transaction-monitoring/">Site Transaction
            Monitoring</a><a class="dropdown-item" href="/product/alerting/">Alerting</a></div>
        </li>
        <li class="nav-item"><a class="nav-link" href="/pricing">Pricing</a></li>
        <li class="nav-item"><a class="nav-link" href="/docs">Docs</a></li>
        <li class="nav-item"><a class="nav-link" href="https://blog.checklyhq.com" target="_blank">Blog</a></li>
        
          <form class="form-inline">
            <input class="form-control py-2" id="search" type="search" placeholder="Search the docs..."/>
          </form>
        
      </ul>
    </div>
  </div>
</nav>

  
  <div class="d-flex container-fluid docs">
    <aside class="docs-menu">
  <nav>
    <a
        class="api-reference-link"
        href="/docs/api"
        target="_blank">API reference
      <div class="badge badge-accent badge-sm ml-2">beta</div></a>
    <ul class="docs-menu-content">
        
      <li class="docs-menu-item">
        <div class="docs-menu-title">Monitoring</div>
        <ul class="docs-menu-sub">
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/monitoring/">
              How we run checks
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/monitoring/global-locations/">
              Global locations
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/monitoring/how-we-store-data/">
              How we store data
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/monitoring/storing-secrets/">
              Storing secrets
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/monitoring/white-listing/">
              White listing &amp; filtering traffic
            </a>
          </li>
          
        </ul>
      </li>
        
      <li class="docs-menu-item">
        <div class="docs-menu-title">API Checks</div>
        <ul class="docs-menu-sub">
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/api-checks/">
              Overview
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/api-checks/request-settings/">
              HTTP request settings
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/api-checks/variables/">
              Environment variables
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/api-checks/assertions/">
              Assertions
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/api-checks/limits/">
              Response time limits
            </a>
          </li>
           
          <li class="docs-menu-sub-item active">
            <a href="/docs/api-checks/setup-teardown-scripts/">
              Setup &amp; teardown scripts
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/api-checks/timouts-timing/">
              Timeouts and timing phases
            </a>
          </li>
          
        </ul>
      </li>
        
      <li class="docs-menu-item">
        <div class="docs-menu-title">Browser Checks</div>
        <ul class="docs-menu-sub">
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/">
              Quickstart
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/scraping-onpage-elements/">
              Scraping &amp; asserting on page elements
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/screenshots/">
              Taking screenshots
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/variables/">
              Environment variables
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/login-scenarios/">
              Login scenarios
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/partials-code-snippets/">
              Partials and code snippets
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/using-mocha/">
              Using Mocha with Puppeteer
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/timeouts/">
              Timeouts
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/responsible-use/">
              Responsible use
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/browser-checks/runner-specification/">
              Runner specification
            </a>
          </li>
          
        </ul>
      </li>
        
      <li class="docs-menu-item">
        <div class="docs-menu-title">Alerting</div>
        <ul class="docs-menu-sub">
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/alerting/">
              Alert settings
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/alerting/alert-channels/">
              Alert channels
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/alerting/alert-states/">
              Alert states
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/alerting/ssl-expiration/">
              SSL certificate expiration
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/alerting/sms-delivery/">
              SMS delivery
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/alerting/webhooks/">
              Webhooks
            </a>
          </li>
          
        </ul>
      </li>
        
      <li class="docs-menu-item">
        <div class="docs-menu-title">CI/CD integration</div>
        <ul class="docs-menu-sub">
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/cicd/github/">
              Github deployments
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/cicd/triggers/">
              Command Line triggers
            </a>
          </li>
          
        </ul>
      </li>
        
      <li class="docs-menu-item">
        <div class="docs-menu-title">Dashboards</div>
        <ul class="docs-menu-sub">
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/dashboards/">
              Url and Custom Domain
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/dashboards/dashboard-look-feel/">
              Look &amp; feel
            </a>
          </li>
          
        </ul>
      </li>
        
      <li class="docs-menu-item">
        <div class="docs-menu-title">Teams</div>
        <ul class="docs-menu-sub">
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/teams/">
              Adding team members
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/teams/about-roles/">
              About roles
            </a>
          </li>
          
        </ul>
      </li>
        
      <li class="docs-menu-item">
        <div class="docs-menu-title">Integrations</div>
        <ul class="docs-menu-sub">
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/integrations/pagerduty/">
              Pagerduty
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/integrations/prometheus/">
              Prometheus
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/integrations/github/">
              Github
            </a>
          </li>
          
        </ul>
      </li>
        
      <li class="docs-menu-item">
        <div class="docs-menu-title">Puppeteer Recorder</div>
        <ul class="docs-menu-sub">
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/puppeteer-recorder/">
              Overview
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/puppeteer-recorder/installation/">
              Installation
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/puppeteer-recorder/basic-usage/">
              Basic Usage
            </a>
          </li>
           
          <li class="docs-menu-sub-item ">
            <a href="/docs/puppeteer-recorder/development/">
              Development
            </a>
          </li>
          
        </ul>
      </li>
       
    </ul>
  </nav>

  
  <script>
    (function () {
      var menu = document.querySelector('aside.docs-menu nav')
  addEventListener('beforeunload', function () {
        localStorage.setItem('menu.scrollTop', menu.scrollTop)
  })
  menu.scrollTop = localStorage.getItem('menu.scrollTop')
})()
  </script>

</aside>



    <div class="docs-page">
      <article class="markdown">
        <h1>Setup &amp; teardown scripts</h1>
        
        <div class="docs-toc-mobile">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#script-execution-flow">Script execution flow</a></li>
    <li><a href="#setup-scripts">Setup scripts</a></li>
    <li><a href="#setup-script-examples">Setup script examples</a>
      <ul>
        <li><a href="#add-a-custom-header">Add a custom header</a></li>
        <li><a href="#update-the-url">Update the URL</a></li>
        <li><a href="#fetch-an-external-token">Fetch an external token</a></li>
        <li><a href="#sign-an-hmac-request">Sign an HMAC request</a></li>
        <li><a href="#sign-an-aws-api-request">Sign an AWS API request</a></li>
        <li><a href="#fetch-an-oauth2-access-token-using-the-client-credentials-grant">fetch an OAuth2 access token using the client_credentials grant</a></li>
        <li><a href="#fetch-an-oauth2-access-token-using-the-password-grant">fetch an OAuth2 access token using the password grant</a></li>
        <li><a href="#create-a-jwt-token-using-the-jsonwebtoken-library">create a JWT token using the jsonwebtoken library</a></li>
      </ul>
    </li>
    <li><a href="#teardown-scripts">Teardown scripts</a></li>
    <li><a href="#teardown-script-examples">Teardown script examples</a>
      <ul>
        <li><a href="#update-response-status">update response status</a></li>
        <li><a href="#delete-created-test-data-based-on-response">delete created test data based on response</a></li>
        <li><a href="#updating-the-json-response-body">updating the JSON response body</a></li>
      </ul>
    </li>
    <li><a href="#reusable-code-snippets">Reusable code snippets</a></li>
    <li><a href="#built-in-variables">Built-in variables</a>
      <ul>
        <li><a href="#environment">Environment</a></li>
        <li><a href="#request">Request</a></li>
        <li><a href="#response">Response</a></li>
      </ul>
    </li>
    <li><a href="#included-libraries">Included libraries</a>
      <ul>
        <li><a href="#built-in-modules">Built-in modules</a></li>
        <li><a href="#external-modules">External modules</a></li>
      </ul>
    </li>
    <li><a href="#technical-limitations">Technical limitations</a></li>
  </ul>
</nav>
        </div>
        <p>You can tailor each HTTP request made by an API check to your exact situation by using setup and/or teardown scripts.</p>
<ul>
<li><strong>Setup scripts</strong> give you access to properties like the URL, headers and query parameters of the HTTP request as well as
all environment variables. Popular use cases are signing HMAC request. requesting tokens and setting up test data.</li>
<li><strong>Teardown scripts</strong> give you access to all the same data as the setup scripts plus the response
object, allowing you to read and modify the response. Use cases are cleaning up test data and scrubbing sensitive
response data for regulatory reasons.</li>
</ul>
<p><img src="/docs/images/api-checks/setup-teardown-1.png" alt="setup and teardown script for http requests"></p>
<p>Both script types are written in Javascript and have access to popular libraries like moment, axios and</p>
<h2 id="script-execution-flow">Script execution flow</h2>
<p>Setup and teardown scripts are executed in a specific order in the Checkly backend. Being aware of this order is important
to get the most out of this feature</p>
<ol>
<li>Each setup script is executed once per check is a dedicated execution sandbox directly as it is scheduled to run. Any changes you make in the
setup script are distributed to each check run on each data center location.</li>
<li>For each configured data center location, the HTTP request of your API check is executed directly followed by the teardown
script. This means your teardown script <em>can run multiple times!</em></li>
<li>After the teardown script has run, all results are collected in our central storage.</li>
</ol>
<p>Both setup and teardown scrips have a <strong>maximum execution time of 4 seconds</strong>.</p>
<p><img src="/docs/images/api-checks/setup-teardown-2.png" alt="setup and teardown script execution"></p>
<div class="alert alert-warning">Setup scripts run once per check. Teardown scripts run on each data center location.</div>

<h2 id="setup-scripts">Setup scripts</h2>
<p>Setup scripts allow you to do last minute processing of test data and request options. The scripts are executed before any
requests are made. You have access to a set of <a href="#built-in-variables">built-in variables</a> so you can tweak the HTTP request
and a set of <a href="#included-third-party-libraries">3rd party libraries</a>.</p>
<p>Note: any libraries need to be explicitly imported using a &lsquo;require&rsquo; statement.</p>
<h2 id="setup-script-examples">Setup script examples</h2>
<h3 id="add-a-custom-header">Add a custom header</h3>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// request.headers is a standard Javascript object
</span><span class="c1"></span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;X-Custom-Header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;my value&#39;</span>
</code></pre></div><h3 id="update-the-url">Update the URL</h3>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// append a value to the request url
</span><span class="c1"></span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;/extra&#39;</span>
</code></pre></div><h3 id="fetch-an-external-token">Fetch an external token</h3>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// explicitly import axios
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">)</span>

<span class="c1">// use &#39;await&#39; on an axios HTTP get to fetch a token from a location
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;https://example.com/api/token&#39;</span><span class="p">)</span>

<span class="c1">// add the token as a query parameters
</span><span class="c1"></span><span class="nx">request</span><span class="p">.</span><span class="nx">queryParameters</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">token</span>
</code></pre></div><h3 id="sign-an-hmac-request">Sign an HMAC request</h3>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// explicitly import libraries
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">CryptoJS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto-js&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;moment&#39;</span><span class="p">)</span>

<span class="c1">// get keys stored in environment variables
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;PRIVATE_KEY&#39;</span><span class="p">]</span>
<span class="kr">const</span> <span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;PUBLIC_KEY&#39;</span><span class="p">]</span>

<span class="c1">// collect the fields used in signing the request
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">method</span>
<span class="kr">const</span> <span class="nx">contentType</span> <span class="o">=</span> <span class="s1">&#39;application/json&#39;</span>
<span class="kr">const</span> <span class="nx">contentMd5</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span>
<span class="kr">const</span> <span class="nx">host</span> <span class="o">=</span> <span class="s1">&#39;localhost:8080&#39;</span>
<span class="kr">const</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^.*\/\/[^\/]+/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">(</span><span class="p">)</span>

<span class="c1">// create the signature
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="p">[</span><span class="nx">method</span><span class="p">,</span> <span class="nx">contentMd5</span><span class="p">,</span> <span class="nx">contentType</span><span class="p">,</span> <span class="nx">timestamp</span><span class="p">]</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,\n&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">encryptedSignature</span> <span class="o">=</span> <span class="nx">publicKey</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">HmacSHA1</span><span class="p">(</span><span class="nx">signature</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">)</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">enc</span><span class="p">.</span><span class="nx">Base64</span><span class="p">)</span>

<span class="c1">// set or update the results as environment variables, to be used in the HTTP request.
</span><span class="c1"></span><span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;TIMESTAMP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">timestamp</span>
<span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;ENCRYPTED_SIGNATURE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">encryptedSignature</span>
<span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;CONTENT_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">contentType</span>
</code></pre></div><h3 id="sign-an-aws-api-request">Sign an AWS API request</h3>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// explicitly import libraries
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">aws4</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;aws4&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">)</span>

<span class="c1">// set up AWS request variables
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;https://s3.eu-central-1.amazonaws.com/checkly-private-test/test.txt&#39;</span>
<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">service</span><span class="o">:</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span>
  <span class="nx">region</span><span class="o">:</span> <span class="s1">&#39;eu-central-1&#39;</span><span class="p">,</span>
  <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;/checkly-private-test/test.txt&#39;</span>
<span class="p">}</span>

<span class="c1">// set up AWS credentials
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">credentials</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">secretAccessKey</span><span class="o">:</span> <span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span class="p">]</span><span class="p">,</span>
  <span class="nx">accessKeyId</span><span class="o">:</span> <span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;AWS_ACCESS_KEY_ID&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">// use the aws4 library to sign the request
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">aws4</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">credentials</span><span class="p">)</span>

<span class="c1">// fetch the data and store in an environment variable
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="nx">headers</span><span class="o">:</span> <span class="nx">signature</span><span class="p">.</span><span class="nx">headers</span> <span class="p">}</span><span class="p">)</span>
<span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;AWS_V4_RESULT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">data</span>
</code></pre></div><h3 id="fetch-an-oauth2-access-token-using-the-client-credentials-grant">fetch an OAuth2 access token using the <code>client_credentials</code> grant</h3>
<p>This example works great for OAuth2 providers like <a href="https://www.okta.com/">Okta</a> and <a href="https://auth0.com/">Auth0</a> that
provide the &ldquo;client_credentials&rdquo; grant type.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// we use the request-promise library here as it supports posting Form data.
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">requestPromise</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request-promise&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">btoa</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;btoa&#39;</span><span class="p">)</span>

<span class="c1">// grab the necessary credentials set up earlier in your environment variables.
</span><span class="c1"></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">ISSUER</span><span class="p">,</span> <span class="nx">TEST_CLIENT_ID</span><span class="p">,</span> <span class="nx">TEST_CLIENT_SECRET</span><span class="p">,</span> <span class="nx">DEFAULT_SCOPE</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">environment</span>

<span class="c1">// assemble a token 
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">btoa</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">TEST_CLIENT_ID</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">TEST_CLIENT_SECRET</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>

<span class="c1">// fetch an access token
</span><span class="c1"></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">access_token</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">requestPromise</span><span class="p">(</span><span class="p">{</span>
  <span class="nx">uri</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">ISSUER</span><span class="si">}</span><span class="sb">/v1/token</span><span class="sb">`</span><span class="p">,</span>
  <span class="nx">json</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
  <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">authorization</span><span class="o">:</span> <span class="sb">`</span><span class="sb">Basic </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
  <span class="p">}</span><span class="p">,</span>
  <span class="nx">form</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">grant_type</span><span class="o">:</span> <span class="s1">&#39;client_credentials&#39;</span><span class="p">,</span>
    <span class="nx">scope</span><span class="o">:</span> <span class="nx">DEFAULT_SCOPE</span><span class="p">,</span>
  <span class="p">}</span><span class="p">,</span>
<span class="p">}</span><span class="p">)</span>

<span class="c1">// set the Authorization header
</span><span class="c1"></span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sb">`</span><span class="sb">Bearer </span><span class="si">${</span><span class="nx">access_token</span><span class="si">}</span><span class="sb">`</span>
</code></pre></div><h3 id="fetch-an-oauth2-access-token-using-the-password-grant">fetch an OAuth2 access token using the <code>password</code> grant</h3>
<p>This example works great for OAuth2 providers like <a href="https://www.okta.com/">Okta</a> and <a href="https://auth0.com/">Auth0</a> that
provide the &ldquo;password&rdquo; grant type. We actually use this one ourselves for monitoring Checkly!</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// we use the request-promise library here as it supports posting Form data.
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">requestPromise</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request-promise&#39;</span><span class="p">)</span>

<span class="c1">// grab the necessary credentials set up earlier in your environment variables.
</span><span class="c1"></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">ISSUER</span><span class="p">,</span> <span class="nx">USERNAME</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">,</span> <span class="nx">CLIENT_ID</span><span class="p">,</span> <span class="nx">CLIENT_SECRET</span><span class="p">,</span> <span class="nx">AUDIENCE</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">environment</span>
 

<span class="c1">// fetch an access token
</span><span class="c1"></span><span class="kr">const</span> <span class="p">{</span> <span class="nx">access_token</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">requestPromise</span><span class="p">(</span><span class="p">{</span>
  <span class="nx">uri</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">ISSUER</span><span class="si">}</span><span class="sb">/oauth/token</span><span class="sb">`</span><span class="p">,</span>
  <span class="nx">json</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
  <span class="nx">form</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">grant_type</span><span class="o">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
    <span class="nx">username</span><span class="o">:</span> <span class="nx">USERNAME</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="nx">PASSWORD</span><span class="p">,</span>
    <span class="nx">client_id</span><span class="o">:</span> <span class="nx">CLIENT_ID</span><span class="p">,</span>
    <span class="nx">client_secret</span><span class="o">:</span> <span class="nx">CLIENT_SECRET</span><span class="p">,</span>
    <span class="nx">audience</span><span class="o">:</span> <span class="nx">AUDIENCE</span>
  <span class="p">}</span><span class="p">,</span>
<span class="p">}</span><span class="p">)</span>

<span class="c1">// set the Authorization header
</span><span class="c1"></span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sb">`</span><span class="sb">Bearer </span><span class="si">${</span><span class="nx">access_token</span><span class="si">}</span><span class="sb">`</span>
</code></pre></div><h3 id="create-a-jwt-token-using-the-jsonwebtoken-library">create a JWT token using the jsonwebtoken library</h3>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// we use the jsonwebtoken library as it makes creating JTW&#39;s really easy
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jsonwebtoken&#39;</span><span class="p">)</span><span class="p">;</span>

<span class="c1">// grab the secret from our environment variables
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">SECRET</span>

<span class="c1">// define a helper function to sign the token
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">getToken</span> <span class="o">=</span> <span class="p">(</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="p">{</span>
      <span class="nx">expiry</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span><span class="p">,</span> <span class="c1">// set the expiry time to 60 minutes
</span><span class="c1"></span>      <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">userId</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="p">}</span><span class="p">,</span> <span class="nx">secret</span> <span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">token</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="p">;</span>
      <span class="nx">resolve</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// create the token
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getToken</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>

<span class="c1">// set the Authorization header
</span><span class="c1"></span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sb">`</span><span class="sb">Bearer </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">`</span>
</code></pre></div><h2 id="teardown-scripts">Teardown scripts</h2>
<p>Teardown scripts are run after the HTTP request has finished, but before any assertions are validated. Next to the <a href="#request">request</a>
and <a href="#environment">environment</a> objects, teardown scripts also have access to the <a href="#response">response</a> object. Use teardown scripts to clean up
any created test data or clean up response data that might contain sensitive information you do not want to store on the
Checkly backend.</p>
<h2 id="teardown-script-examples">Teardown script examples</h2>
<h3 id="update-response-status">update response status</h3>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">201</span>
</code></pre></div><h3 id="delete-created-test-data-based-on-response">delete created test data based on response</h3>
<p>This is an actual script we use to monitor our own &ldquo;create API check&rdquo; API endpoint. It runs after a normal API check where
we POST an JSON blob to the <code>/accounts/&lt;uuid&gt;/checks</code> endpoint, which returns the created resource with its ID.
Notice how we reuse the environment variables to pass in credentials and tokens.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// explicitly import axios
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">)</span>

<span class="c1">// parse the create resource,
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">createdResource</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>

<span class="c1">// setup the correct url and its parameters
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">host</span> <span class="o">=</span> <span class="s1">&#39;https://api.checklyhq.com&#39;</span>
<span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="s1">&#39;/checks/&#39;</span> <span class="o">+</span> <span class="nx">createdResource</span><span class="p">.</span><span class="nx">id</span>

<span class="c1">// set the correct auth headers
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;Authorization&#39;</span><span class="o">:</span> <span class="s1">&#39;Bearer &#39;</span> <span class="o">+</span> <span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;API_BEARER&#39;</span><span class="p">]</span><span class="p">,</span>
  <span class="s1">&#39;X-Checkly-Account&#39;</span><span class="o">:</span> <span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;CHECKLY_ACCOUNT_ID&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1">// delete the just created resource using the axios HTTP client
</span><span class="c1"></span><span class="nx">await</span> <span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">path</span><span class="p">,</span> <span class="p">{</span> <span class="nx">headers</span> <span class="p">}</span><span class="p">)</span>
</code></pre></div><h3 id="updating-the-json-response-body">updating the JSON response body</h3>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Parse the body as JSON
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>

<span class="c1">// manipulate the object
</span><span class="c1"></span><span class="nx">body</span><span class="p">.</span><span class="nx">someKey</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1">// store it again as a JSON string
</span><span class="c1"></span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
</code></pre></div><p>Note: Remember that teardown scripts run on each configured data center location.</p>
<h2 id="reusable-code-snippets">Reusable code snippets</h2>
<p>To DRY (Dont&rsquo; Repeat Yourself) up your code, we advise you strongly to create all setup and teardown scripts as code
snippets. You can create, update and delete code snippets in the account section. Snippets are available to all checks.</p>
<p><img src="/docs/images/api-checks/snippets-list.png" alt="reusable code snippets"></p>
<p>Once created, just select any snippets from the drop down menu in setup and teardown scripts section of your API check.</p>
<h2 id="built-in-variables">Built-in variables</h2>
<p>Inside each script, you have access to certain data structures of the API check lifecycle.</p>
<h3 id="environment">Environment</h3>
<p>You have access to all environment variables configured in the variables section on the account page.
They are exposed as a regular Javascript object named <code>environment</code>.</p>
<p>You can create, read, update and delete any of the attributes in this object.</p>
<p>The current data center location the script is running in is exposed as the AWS region code in the <code>REGION</code> constant,
i.e. <code>eu-west-1</code> or <code>us-east-1</code></p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// read values and use them for further processing
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">myValue</span> <span class="o">=</span> <span class="nx">environment</span><span class="p">.</span><span class="p">[</span><span class="s1">&#39;MY_KEY&#39;</span><span class="p">]</span>

<span class="c1">// write values
</span><span class="c1"></span><span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;MY_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">myValue</span> <span class="o">+</span> <span class="mi">10</span>

<span class="c1">// add a new key/value pair
</span><span class="c1"></span><span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;NEW_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;new value&#39;</span>

<span class="c1">// remove a key
</span><span class="c1"></span><span class="k">delete</span> <span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;SOME_OTHER_KEY&#39;</span><span class="p">]</span>

<span class="c1">// read the current region
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">region</span> <span class="o">=</span> <span class="nx">environment</span><span class="p">[</span><span class="s1">&#39;REGION&#39;</span><span class="p">]</span>
</code></pre></div><p>In setup scripts, the modified environment object is used for the subsequent HTTP request. In teardown
script, the modified environment object is just there for informational purposes.</p>
<p><a href="/docs/api-checks/variables/">More about using environment variables</a></p>
<h3 id="request">Request</h3>
<p>Request properties are exposed a standard Javascript object. This object is available in both setup and teardown scripts.</p>
<table>
<thead>
<tr>
<th>property</th>
<th>description</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>request.method</code></td>
<td>The HTTP request method, i.e. &lsquo;GET&rsquo;, &lsquo;POST&rsquo; etc.</td>
<td>String</td>
</tr>
<tr>
<td><code>request.url</code></td>
<td>The request url. Any separately defined query parameters are added at the end.</td>
<td>String</td>
</tr>
<tr>
<td><code>request.body</code></td>
<td>The request body in string format.</td>
<td>String</td>
</tr>
<tr>
<td><code>request.headers</code></td>
<td>The request headers.</td>
<td>Object</td>
</tr>
<tr>
<td><code>request.queryParameters</code></td>
<td>The request query parameters.</td>
<td>Object</td>
</tr>
</tbody>
</table>
<h3 id="response">Response</h3>
<p>Response properties are exposed a standard Javascript object. These are only available in teardown scripts.</p>
<table>
<thead>
<tr>
<th>property</th>
<th>description</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>response.statusCode</code></td>
<td>The response status code, i.e. 200 or 404.</td>
<td>Number</td>
</tr>
<tr>
<td><code>response.statusText</code></td>
<td>The response status text, i.e. &lsquo;Ok&rsquo; or &lsquo;Not found&rsquo;.</td>
<td>String</td>
</tr>
<tr>
<td><code>response.body</code></td>
<td>The response body in string format. You will need to use <code>JSON.parse(response.body)</code> to access JSON responses.</td>
<td>String</td>
</tr>
<tr>
<td><code>response.headers</code></td>
<td>The response headers in the form of a standard Javascript object.</td>
<td>Object</td>
</tr>
<tr>
<td><code>response.timings</code></td>
<td>Various timestamps for the request stage relative to the starting time.</td>
<td>Object</td>
</tr>
<tr>
<td><code>response.timingPhases</code></td>
<td>Time durations for each request phase.</td>
<td>Object</td>
</tr>
</tbody>
</table>
<h2 id="included-libraries">Included libraries</h2>
<p>All setup and teardown scripts run in a sandboxed environment on our cloud backed. You do not have full access to the Node.js
standard library or to arbitrary NPM modules. Currently every runner is equipped with the following libraries:</p>
<h3 id="built-in-modules">Built-in modules</h3>
<ul>
<li>assert</li>
<li>buffer</li>
<li>crypto</li>
<li>path</li>
<li>querystring</li>
<li>readline</li>
<li>stream</li>
<li>string_decoder</li>
<li>stream</li>
<li>timers</li>
<li>tls</li>
<li>url</li>
<li>util</li>
<li>zlib</li>
</ul>
<p>See the <a href="https://nodejs.org/dist/latest-v10.x/docs/api/">built-in module documentation on the official Node.js site</a></p>
<h3 id="external-modules">External modules</h3>
<ul>
<li><strong><a href="https://github.com/mhart/aws4">aws4</a></strong> 1.8.0: Third-party library for easily signing AWS API requests.</li>
<li><strong><a href="https://github.com/axios/axios">axios</a></strong>  0.18.0: A modern HTTP library. Supports async/await.</li>
<li><strong><a href="https://www.npmjs.com/package/btoa">btoa</a></strong> 1.2.1: Binary to base64 encoded ascii. Handy for parsing some response bodies.</li>
<li><strong><a href="https://github.com/auth0/node-jsonwebtoken">jsonwebtoken</a></strong>  8.5.1: Implementation of JSON web tokens. Helps with signing.</li>
<li><strong><a href="https://github.com/brix/crypto-js">crypto-js</a></strong> 3.1.9: Cryptographic function library.</li>
<li><strong><a href="https://lodash.com">lodash</a></strong> 4.14.11: Javascript toolkit for many object, array and other functions.</li>
<li><strong><a href="https://momentjs.com">moment</a></strong> 2.22.2: Popular library for all things time related.</li>
<li><strong><a href="https://nodejs.org/en/blog/release/v0.8.10/">node</a></strong> 8.10: The general Node.js execution environment.</li>
<li><strong><a href="https://github.com/request/request">request</a></strong> 2.88.0: An alternative HTTP client to Axios that supports posting Form data.</li>
<li><strong><a href="https://github.com/request/request-promise">request-promise</a></strong> 4.2.2: A plugin for the request library to enable promises.</li>
<li><strong><a href="https://github.com/kelektiv/node-uuid">uuid</a></strong> 3.3.3: Simple, fast generation of UUIDS.</li>
</ul>
<h2 id="technical-limitations">Technical limitations</h2>
<ul>
<li>Setup and teardown scripts are implicitly wrapped in async function. This means you can always use <code>await</code> statements.</li>
<li>You cannot use nested callbacks as there is no way to determine the callback function. Always use <code>await</code> statements.</li>
<li>Script execution is limited to 4 seconds maximum.</li>
<li>You need to include modules and libraries explicitly, i.e. <code>const moment = require('moment')</code> before you can use them.</li>
</ul>
</article>
      <hr class="pt-2 mb-2" />
      
      <div class="text-right mb-4">
        <a href="https://checklyhq.com/docs/api-checks/timouts-timing/">Next: Timeouts and timing phases
        </a>
      </div>
      
    </div>
    
    <aside class="docs-toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#script-execution-flow">Script execution flow</a></li>
    <li><a href="#setup-scripts">Setup scripts</a></li>
    <li><a href="#setup-script-examples">Setup script examples</a>
      <ul>
        <li><a href="#add-a-custom-header">Add a custom header</a></li>
        <li><a href="#update-the-url">Update the URL</a></li>
        <li><a href="#fetch-an-external-token">Fetch an external token</a></li>
        <li><a href="#sign-an-hmac-request">Sign an HMAC request</a></li>
        <li><a href="#sign-an-aws-api-request">Sign an AWS API request</a></li>
        <li><a href="#fetch-an-oauth2-access-token-using-the-client-credentials-grant">fetch an OAuth2 access token using the client_credentials grant</a></li>
        <li><a href="#fetch-an-oauth2-access-token-using-the-password-grant">fetch an OAuth2 access token using the password grant</a></li>
        <li><a href="#create-a-jwt-token-using-the-jsonwebtoken-library">create a JWT token using the jsonwebtoken library</a></li>
      </ul>
    </li>
    <li><a href="#teardown-scripts">Teardown scripts</a></li>
    <li><a href="#teardown-script-examples">Teardown script examples</a>
      <ul>
        <li><a href="#update-response-status">update response status</a></li>
        <li><a href="#delete-created-test-data-based-on-response">delete created test data based on response</a></li>
        <li><a href="#updating-the-json-response-body">updating the JSON response body</a></li>
      </ul>
    </li>
    <li><a href="#reusable-code-snippets">Reusable code snippets</a></li>
    <li><a href="#built-in-variables">Built-in variables</a>
      <ul>
        <li><a href="#environment">Environment</a></li>
        <li><a href="#request">Request</a></li>
        <li><a href="#response">Response</a></li>
      </ul>
    </li>
    <li><a href="#included-libraries">Included libraries</a>
      <ul>
        <li><a href="#built-in-modules">Built-in modules</a></li>
        <li><a href="#external-modules">External modules</a></li>
      </ul>
    </li>
    <li><a href="#technical-limitations">Technical limitations</a></li>
  </ul>
</nav>
    </aside>
    
  </div>

  
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
        integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
        integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
        integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script src="/js/index.js"></script>

  <script>
    docsearch({
      apiKey: 'b2b616fdea14b860ff00c72fa72bf267',
      indexName: 'checkly_docs',
      appId: 'LCMJSZN73Z',
      inputSelector: '#search',
      debug: false
    })
  </script>
</body>
</html>
